var alldata = {
	"pricelistall" : [
		{
			name : "Amala",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Arvi",
			cost : 10,
			costText : "10/Kg"
		},
		{
			name : "Banana KL",
			cost : 280,
			costText : "280/Kg"
		},
		{
			name : "Banana raw",
			cost : 130,
			costText : "130/Kg"
		},
		{
			name : "Basil",
			cost : 190,
			costText : "190/Kg"
		},
		{
			name : "Beans ring",
			cost : 140,
			costText : "140/Kg"
		},
		{
			name : "Beans type",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Beans white",
			cost : 190,
			costText : "190/Kg"
		},
		{
			name : "beetroot",
			cost : 100,
			costText : "100/Kg"
		},
		{
			name : "Bitter gard",
			cost : 130,
			costText : "130/Kg"
		},
		{
			name : "Bottle gard",
			cost : 170,
			costText : "170/Kg"
		},
		{
			name : "Brinjol brown big",
			cost : 190,
			costText : "190/Kg"
		},
		{
			name : "Brinjol brown long",
			cost : 130,
			costText : "130/Kg"
		},
		{
			name : "Brinjol long",
			cost : 100,
			costText : "100/Kg"
		},
		{
			name : "Brinjol purple",
			cost : 150,
			costText : "150/Kg"
		},
		{
			name : "Brookli",
			cost : 140,
			costText : "140/Kg"
		},
		{
			name : "Cabbage chinless",
			cost : 190,
			costText : "190/Kg"
		},
		{
			name : "Cabbage red",
			cost : 130,
			costText : "130/Kg"
		},
		{
			name : "Cabbage white",
			cost : 160,
			costText : "160/Kg"
		},
		{
			name : "Cauliflower",
			cost : 130,
			costText : "130/Kg"
		},
		{
			name : "Capsicum",
			cost : 190,
			costText : "190/Kg"
		},
		{
			name : "Capsicum red",
			cost : 100,
			costText : "100/Kg"
		},
		{
			name : "Capsicum yellow",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Carrot local",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Carrot Ooty",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Carrot rashi ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Carrot red Delhi",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Corn baby",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Corn sweat",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Corn full",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Chilly",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Chilly bajji",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Chilly gr small",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Chow Chow",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Cucumber",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Cucumber English",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Cucumber mang.",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Drum stick",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Garlic",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Garlic pealed",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Ginger 1st grd",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Ginger new",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Ice berg",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Jigni green",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Jigni yellow",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Kadu ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Lady finger",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Lemon",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Maize",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Mashroom",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Nookhel",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Onion",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Onion sambar",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Onion white",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Parvel",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Peas green ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Peas green nati",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Peas green color pealed ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Potato",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Potato baby",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Potato sweat",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Pumpkin  ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Pumpkin red",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Pumpkin white",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Radish red",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Radish white",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Rich gard ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Snake gard",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Tinda ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Tomato ",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Tomato small",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Tomato cellary",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Turnip",
			cost : 180,
			costText : "180/Kg"
		},
		{
			name : "Yam",
			cost : 180,
			costText : "180/Kg"
		}
	]
}
$(document).ready(function(){
	var templatingFunction = function(localdata){
		$.each(localdata, function(i, v){
			var $mytemplate = $('<tr/>'), inputhtml = '<input type="text" placeholder="0">';
			$('<td/>').addClass('product-name').text(v.name).appendTo($mytemplate);
			$('<td/>', {'data-cost' : v.cost}).addClass('product-cost').text(v.costText).appendTo($mytemplate);
			$('<td/>').addClass('product-quantity').html(inputhtml).appendTo($mytemplate);
			$('<td/>', {'data-amount' : '0'}).addClass('product-amount').text(0).appendTo($mytemplate);
			$mytemplate.appendTo($('#shafeeq'))
		})
	}

	if($('body').hasClass('home')){
		// if($.cookie('authenticated') == "true" && ($.cookie('username')))
		templatingFunction(alldata['pricelistall']);
		// else
		// window.location = "/login.html";
	}

	var calcTotal = function(){
		var totalCostNow = 0;
		$('table tbody .product-amount').each(function(){
			totalCostNow += parseInt($(this).data('amount'));
		})
		if(totalCostNow > 0){
			$('.sticky-footer').show();
			$('.sticky-footer span').eq(1).text(totalCostNow);
		}
		else
		$('.sticky-footer').hide();
	}

	$('#shafeeq').on('input', '.product-quantity input', function(){
		$this = $(this);
		jElParent = $this.closest('tr');
		$('#shafeeq tr').show();
		$('#searchproducts').val('');
		var amount = $this.val() * jElParent.find('.product-cost').data('cost');
		jElParent.find('.product-amount').text(amount);
		jElParent.find('.product-amount').data('amount', amount);
		calcTotal();
	})

	$('body').click("#localsearchproducts" , function(){
		$('#searchproducts').focus();
	})

	$('body').click("#loggout" , function(){
		alert("jgsdf")
	})

	if($.cookie('authenticated') == "true" && ($.cookie('username'))){
		$('#loggout').show();
	}

	if($('body').hasClass('order')){
		if($.cookie('authenticated') != "true"){
			window.location= "/login.html";
		}
		var localObject = JSON.parse(localStorage.getItem('productlist'));
		if(jQuery.isEmptyObject(localObject))
		window.location = "/login.html";
		templatingFunction(localObject);
		$('#shafeeq tr .product-quantity input').each(function(i){
			$(this).val(localObject[i]['quantity']).trigger('input');
		})
	}

	$('#searchproducts').on("keyup", function() {
		var g = $(this).val().toLowerCase();
		$("#shafeeq .product-name").each(function() {
			var s = $(this).text().toLowerCase();
			$(this).closest('tr')[ s.indexOf(g) !== -1 ? 'show' : 'hide' ]();
		});
	});

	$('#place-order').click(function(){
		var productlist = [];
		$.each($('#shafeeq tr .product-quantity input'), function(){
			if($(this).val() > 0){
				var productObject = {};
				productObject.name = $(this).closest('tr').find('.product-name').text();
				productObject.cost = $(this).closest('tr').find('.product-cost').data('cost');
				productObject.costText = $(this).closest('tr').find('.product-cost').text();
				productObject.quantity = $(this).closest('tr').find('.product-quantity input').val();
				productlist.push(productObject);
			}
		})
		localStorage.removeItem('productlist');
		localStorage.setItem('productlist', JSON.stringify(productlist));
		if($.cookie('authenticated') == "true" && ($.cookie('username'))){
			window.location = "/placeorder.html";
		}
		else{
			window.location = "/login.html";
		}
	})

	//Submit final order
	$('#finalplace').click(function(e){
		e.preventDefault();
		var productlist = [];
		$.each($('#shafeeq tr .product-quantity input'), function(){
			if($(this).val() > 0){
				var productObject = {};
				productObject.name = $(this).closest('tr').find('.product-name').text();
				productObject.cost = $(this).closest('tr').find('.product-cost').data('cost');
				productObject.costText = $(this).closest('tr').find('.product-cost').text();
				productObject.quantity = $(this).closest('tr').find('.product-quantity input').val();
				productlist.push(productObject);
			}
		})
		localStorage.removeItem('productlist');
		localStorage.setItem('productlist', JSON.stringify(productlist));
		var localObject = JSON.parse(localStorage.getItem('productlist')) , dataToSend = {};
		if(jQuery.isEmptyObject(localObject) || !$.cookie('authenticated') || !$.cookie('username'))
		window.location = "/login.html";
		dataToSend.order = localObject;
		dataToSend.username = $.cookie('username');
		$.ajax({
			method: "POST",
			url: "placeorder.php",
			data: {"myData":dataToSend}
		})
		.done(function(data) {
			if(data == "success"){
				alert("Order sucessful");
				localStorage.removeItem('productlist');
				window.location = "/index.html";
			}
			else{
				alert("Sorry order not placed");
				window.location = "/login.html";
			}
		})
		.fail(function() {
			alert( "error" );
		})
	})
	$('#hideonscroll').hide();
	//Submit login form
	$('form#login').submit(function(e){
		e.preventDefault();
		var dataToSend = {};
		$(this).find('input').each(function(){
			dataToSend[$(this).attr('name')] = $(this).val();
		});
		$.ajax({
			method: "POST",
			url: "credentialscheck.php",
			data: dataToSend
		})
		.done(function(data) {
			if(data != "false"){
				$.cookie('username', $('input[name="username"]').val(), { expires: 7, path: '/' });
				$.cookie('authenticated', 'true', { expires: 7, path: '/' });
				$.cookie('pricelist', data, { expires: 7, path: '/' });
				window.location = "/index.html";
			}
			else{
				$('.loginerror').show();
				//alert("wrong credentials");
			}
		})
		.fail(function() {
			alert( "error" );
		})
	})

	//Submit register form
	$('form#register').submit(function(e){
		e.preventDefault();
		var dataToSend = {};
		$(this).find('input').each(function(){
			dataToSend[$(this).attr('name')] = $(this).val();
		})
		$.ajax({
			method: "POST",
			url: "queryexec.php",
			data: dataToSend
		})
		.done(function(data) {
			if(data == "done"){
				$.cookie('authenticated', 'true', { expires: 7, path: '/' });
				$.cookie('username', $('input[name="username"]').val(), { expires: 7, path: '/' });
				window.location = "/placeorder.html";
			}
			else if(data == "multipleentries"){
				alert("Username already exists")
			}
			else{
				alert("Sorry Please try again")
			}
		})
		.fail(function() {
			alert( "error" );
		})
	})
})
